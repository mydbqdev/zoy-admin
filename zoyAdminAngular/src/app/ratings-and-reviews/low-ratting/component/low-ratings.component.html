<ngx-spinner bdColor="rgba(0,0,0,0.8)" size="medium" color="#fff" type="custom" [fullScreen]="true">
  <div class="spinner-container"><img class="spinner-home-logo" src="assets/images/home-logo.png" alt="Home"/>
    <img class="spinner-location-logo" src="assets/images/location-logo.png" alt="User"/>
    <div class="spinner-loading">Loading</div>
  </div>
</ngx-spinner>
<div id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
      <!-- Sidebar -->
      <app-sidebar></app-sidebar>
      <!-- End of Sidebar -->

      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column" [ngClass]=" isExpandSideBar ?'side-bar-expand':'side-bar-collaspe'">
          <!-- Main Content -->
          <div id="content">
                <div style="display: block;margin-bottom: 5.375rem;">
                <!-- Topbar -->
                <app-header></app-header>
                <!-- End of Topbar -->
                </div>

              <!-- Begin Page Content -->
              <div class="container-fluid">
                <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between mb-3 flex-wrap gap-2">
  <!-- Left: Header -->
  <div class="mb-2 mb-md-0">
    <h3 class="h3 mb-0">
      <span class="text-header-800 text-header-border">Low</span>
      <span class="text-header-800-blue">Rating</span>
    </h3>
  </div>

  <div class="d-flex flex-wrap align-items-center gap-2">
    <div>
      <select
        class="form-select form-select-sm"
        [(ngModel)]="cityLocationName"
        (ngModelChange)="callLowRattingDetails()"
        style="font-size: 15px;"
        [title]="'City / Location'"
      >
        <option *ngFor="let city of cityLocation" [value]="city">{{ city }}</option>
      </select>
    </div>

    <div>
      <div class="input-group input-group-sm">
        <span class="input-group-text bg-white border-right-0" style="border-radius: 20px 0 0 20px;">
          <i class="fas fa-search fa-sm"></i>
        </span>
        <input
          type="text"
          class="form-control border-left-0"
          style="border-radius: 0 20px 20px 0; padding-left: 5px; width: 200px;"
          [(ngModel)]="searchText"
          (keyup)="searchBy($event)"
          placeholder="Search"
        />
      </div>
    </div>
<div class="dropdown no-arrow">
   <button class="btn btn-primary-custom btn-sm"  role="button" id="dropdownMenuDownload" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" [disabled]="downloadProgress">
     <i class="fas fa-download mr-2" *ngIf="!downloadProgress"></i>
      <img src="assets/images/loading.gif" class="mr-1" *ngIf="downloadProgress">
       <span style="font-size: 12px;" >Download<span *ngIf="downloadProgress">ing</span> </span>
        </button>                           
         <div class="dropdown-menu dropdown-menu-right shadow animated-fade-in" aria-labelledby="dropdownMenuDownload" style="min-width:1rem !important;">
           <a class="dropdown-item" href="javascript:void(0)" (click)="downloadPdf('pdf')">As Pdf </a><hr style="margin-top: 0rem !important; margin-bottom: 0rem !important;">
           <a class="dropdown-item" href="javascript:void(0)" (click)="downloadPdf('excel')"> As Excel</a><hr style="margin-top: 0rem !important; margin-bottom: 0rem !important;">
           <a class="dropdown-item" href="javascript:void(0)" (click)="downloadPdf('csv')">As CSV</a>   
          </div>
      </div>
  </div>
</div>

                  <div class="row mt-2">
                      <div class="col-xl-12 col-lg-12">
                          <div class="card shadow mb-3">
                              <!-- Card Body -->
                              <div class="card-body" style="padding: 2px;margin: 0px;" >
                                <div>
                                <div class="scrollable-container-main">    
                                  <table mat-table [dataSource]="lowRatingDataSource" matSort
                                           (matSortChange)="onSortData($event)" matSortActive="name" matSortDirection="asc" 
                                           matSortDisableClear multiTemplateDataRows>
                                    <ng-container *ngFor="let column of displayedColumns">
                                      <ng-container [matColumnDef]="column" *ngIf=" column != 'reviews'">
                                        <th mat-header-cell *matHeaderCellDef mat-sort-header style="font-weight: 400;" [matTooltip]="columnHeaders[column] "> 
                                        {{ columnHeaders[column] || column }}
                                          <i class="fas fa-lg fa-sort ml-1" style="color:#d1cfcf;margin-right: 3px;"></i>
                                          <i class="fas fa-lg fa-sort-up" *ngIf="sortActive === column && sortDirection === 'asc'" 
                                             style="margin-right: 3px;margin-left: -14px;"></i>
                                          <i class="fas fa-lg  fa-sort-down" *ngIf="sortActive === column && sortDirection === 'desc'" 
                                             style="margin-right: 3px;margin-left: -14px;"></i></th>
                                        <td mat-cell *matCellDef="let element" > 
                                           {{  element[column] == undefined || element[column] == '' ? '-' : element[column] }} 
                                        </td>
                                      </ng-container>
                                    </ng-container>

                                    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky:true"  ></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;" data-toggle="modal" data-target="#reviewsModel" (click)="viweReviewsReplyDetails(row)"></tr>
                                  </table>
                                  <div style="text-align: center; min-height: 45px; padding-top: 10px;" 
                                  *ngIf="lowRatingDataSource.data.length === 0">
                                    No records found
                                  </div>
                                   </div> 
                                   <mat-paginator #paginator [length]="totalProduct" [pageSize]="pageSize" 
                                   [pageSizeOptions]="pageSizeOptions" showFirstLastButtons 
                                   (page)="pageChanged($event)">
                                  </mat-paginator>
                                  </div> 
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <!-- /.container-fluid -->

          </div>
          <!-- End of Main Content -->

      </div>
      <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->
</div>

<div class="modal fade" id="reviewsModel" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog model-center" role="document">  
    <div class="modal-content">
     <div class="modal-header" style="color: #fff;background-color: #925FE2;border-color: #955cf1;"> 
        <h5 class="modal-title ">Review Summary</h5>
        <button type="button"  class="btn-close" data-dismiss="modal" aria-label="Close"  #reviewsModelClose >
        </button>
      </div>
      <div class="modal-body">
        
        <div class="pl-3 pr-3">
          <div class="row">
            <div class="col-sm-4" style="font-size: 14px;">PG Property Name</div>
            <div class="col-sm-1 align-items-center">:</div>
            <div class="col-sm-6" style="font-size: 14px;color: gray;">{{reviewsReplyDetails.pgName}}</div>
            <div class="col-sm-1">
              <div class="rating-container">
                <div class="rating-box" [ngClass]="{'low-rating': +reviewsReplyDetails.overallRating < 3}">
                  <span class="star">&#9733;</span> 
                  <span class="rating-number"> {{reviewsReplyDetails.overallRating}}</span> 
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-sm-4" style="font-size: 14px;">Owner Name</div>
            <div class="col-sm-1 align-items-center">:</div>
            <div class="col-sm-7" style="font-size: 14px;color: gray;">{{reviewsReplyDetails.ownerName}}</div>
          </div>
          <div class="row">
            <div class="col-sm-4" style="font-size: 14px;">Owner Mobile no.</div>
            <div class="col-sm-1 align-items-center">:</div>
            <div class="col-sm-7" style="font-size: 14px;color: gray;">{{reviewsReplyDetails.ownerContactNum}}</div>
          </div>
          <div class="row">
            <div class="col-sm-4" style="font-size: 14px;">Tenant Name</div>
            <div class="col-sm-1 align-items-center">:</div>
            <div class="col-sm-7" style="font-size: 14px;color: gray;">{{reviewsReplyDetails.customerName}}</div>
          </div>
          <div class="row">
            <div class="col-sm-4" style="font-size: 14px;">Tenant Mobile no.</div>
            <div class="col-sm-1 align-items-center">:</div>
            <div class="col-sm-7" style="font-size: 14px;color: gray;">{{reviewsReplyDetails.customerMobileNo}}</div>
          </div>
        
      </div>
        <div class="card card-body ml-2 mr-2 mb-2 p-2 " style="max-height: 400px; overflow-y: auto;">
          <div class="mt-2 ml-2">
            <div class="d-flex">
            <div>
                <div class="profile-top" *ngIf="!reviewsReplyDetails.customerImage" > 
                    {{reviewsReplyDetails.customerName?.charAt(0).toUpperCase()}} 
                </div>
                <img [src]="reviewsReplyDetails.customerImage" *ngIf="reviewsReplyDetails.customerImage" class="profile-top" alt="User Image">                        
            </div>
            <div>
            <div style="padding-top:5px">    
            <span class="ml-2 d-none d-lg-inline text-gray-600 small text-truncate" style="max-width: 100px;">
                {{reviewsReplyDetails.customerName}} 
            </span>
            </div>
            <div class="ml-2" style="font-size: 11px;color:#bdb9b9;"> {{reviewsReplyDetails.reviewDate  | date: 'MMM d, y' }}</div>
          </div>
           </div>
          <div> {{reviewsReplyDetails.writtenReview}} </div>
        </div>
        <div >
          <div class="mt-2"  *ngFor="let review of reviewsReplyDetails.reviews" >
              <div *ngIf="review.customerId">
                <div class="d-flex">
                <div>
                    <img [src]="review.customerImage" *ngIf="review.customerImage" class="profile-top" alt="User Image">                        
                </div>
                <div>
                    <div> 
                      <span class="ml-2 d-none d-lg-inline text-gray-600 small text-truncate" style="max-width: 100px;">
                        {{review.customerName}} 
                    </span>
                    </div>
                <div class="ml-2" style="font-size: 11px;color:#bdb9b9;"> {{review.timeStamp  | date: 'MMM d, y' }} <span *ngIf="review.isEdited"> .Edited</span></div>
              </div>
              <div> {{review.review}} </div>
            </div>
          </div>
          <div style="border-left: 2px solid #e5e3e3;" class=" d-flex ml-3" *ngIf="review.partnerId">
              <div>
                <div>
                   <span class="d-none d-lg-inline text-gray-600 small text-truncate" style="max-width: 100px;">
                    Response from Owner
                   </span>
                <span style="font-size: 11px;color:#bdb9b9;"> {{review.timeStamp  | date: 'MMM d, y' }} <span *ngIf="review.isEdited"> .Edited</span></span>
                </div>
              <div> {{review.review}} </div>
            </div>
        </div>
          </div>
        </div>
      </div>
      </div>
    </div>
  </div>
</div>